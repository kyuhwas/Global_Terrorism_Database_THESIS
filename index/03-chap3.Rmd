# Statistical Hypothesis Testing {#hypothesis-testing}

This chapter is an extension to chapter 2 (Impact Analysis) and peforms correlation test on numeric variables and hypothesis testing between groups and fatalities on data specific to top 10 most active and violent terrorist groups that were identified earlier. 

## Data Preparation

```{r }
dfh <- df %>%	
  filter(group_name %in% top10_groups) %>% 	# filter data by top 10 groups
  replace_na(list(nkill = 0, nwound = 0)) 	# replace NAs

# Shorten lengthy group names
dfh$group_name[dfh$group_name == "Kurdistan Workers' Party (PKK)"] <- "PKK"
dfh$group_name[dfh$group_name == "Al-Qaida in the Arabian Peninsula (AQAP)"] <- "AQAP"
dfh$group_name[dfh$group_name == "Houthi extremists (Ansar Allah)"] <- "Houthi_Extrm"
dfh$group_name[dfh$group_name == "Tehrik-i-Taliban Pakistan (TTP)"] <- "TTP"
dfh$group_name[dfh$group_name == "Al-Nusrah Front"] <- "Al-Nusrah"
dfh$group_name[dfh$group_name == "Islamic State of Iraq and the Levant (ISIL)"] <-"ISIL"
dfh$group_name[dfh$group_name == "Donetsk People's Republic"] <- "Donetsk_PR" 
```

## Correlation Test

Let’s begin with correlation test to understand relationship between variables. I use pairwise complete observations method to compute correlation coefficients for each pair of numerical variables. Missing values are replaced appropriately to preserve statistical accuracy between variables. 

```{r fig.cap="Correlation web plot", fig.height=6, out.width= "100%"}

tmp <- dfh %>%
  select(intl_ideological_attack, intl_logistical_attack, 
         part_of_multiple_attacks, n_peace_keepers, net_migration, 
         refugee_asylum, refugee_origin, gdp_per_capita, arms_import, 
         arms_export, conflict_index, population, extended, 
         nwound, nkill, suicide_attack, attack_success) 

# get the correlation matrix
m <- cor(tmp, use="pairwise.complete.obs")

# Get rid of all non significant correlations
ctest <- PairApply(tmp, function(x, y) cor.test(x, y)$p.value, 
                   symmetric=TRUE)

m[ctest > 0.05] <- NA 	# Replace p value > 0.05 with NAs

PlotWeb(m, lwd = abs(m[lower.tri(m)] * 10), 
        cex.lab = 0.85, pt.bg = "#f2f2f2",
        args.legend = list(x = "bottomright", 
                           cex = 0.75, bty = "0", 
                           title = "Correlation"),
        main="Correlation Web Plot")
```


## Hypothesis Test: Fatalities vs Groups

The objective behind this hypothesis is to determine whether or not means of the top 10 groups with respect to average fatalities are same. If at least one sample mean is different to others then we determine which pair of groups are different. 

$$
\large
\begin{aligned}
{H_0 : } & \text{ The means of the different groups are the same} \\
      &{(ISIL)} = {(Taliban)} = {(AQAP)} = {(Al-Shabaab)} = \\
      &{(Al-Shabaab)} = {(TTP)} = {(Boko Haram)} =  \\
      &{(Al-Nusrah)} = {(Donetsk_PR)} = {(Houthi_Extrm)} \\ \\
H_a: & \text{ At least one sample mean is not equal to the others} 
\end{aligned}
$$


```{r fig.cap="Boxplot: Group vs Fatalities", fig.height=4, out.width = "100%"}

ggplot(dfh, aes(group_name, nkill, fill = group_name)) + 
   geom_boxplot(outlier.stroke = 0.1) + 
   geom_jitter(alpha = 0.03, aes(color = group_name)) +    
   theme_minimal() + coord_flip() + scale_y_log10() +
   ggtitle("Boxplot of Groups vs Fatalities") + 
   xlab("Name of the group") + ylab("Total fatalities (log10)") +
   theme(plot.title = element_text(size=12), legend.position = "none") 
  
```

In statistical terms, we have some extreme outliers i.e. nkill ~ 1500 in ISIL group so X axis is log transformed for visualization purpose. 

### ANOVA Test

The ANOVA model computes the residual variance and the variance between sample means in order to calculate the F-statistic. This is the first step to determine whether or not means are different in pair of groups.

$$
\large
\begin{aligned}
F-statistic = & (S^2_{between}\ / S^2_{within})
\end{aligned}
$$

```{r }
# Compute the analysis of variance
r.aov <- aov(nkill ~ group_name , data = dfh)
# Summary of the analysis
summary(r.aov)
```

Model summary provides us F value and Pr(>F) corresponding to the p-value of the test. As we can see that p-value is < 0.05, which means there are significant differences between the groups. In other words, we reject the null hypothesis. From this test, we identified that some of the group means are different. The next step is to identify which pair of groups are different. 

### PostHoc Test

PostHoc test is useful to determine where the differences occurred between groups. For this test, I use several different methods for the comparison purpose. This methods can be classified as either conservative or liberal approach. Conservative methods are considered to be robust against committing Type I error as they use more stringent criterion for statistical significance. First we compare results from The Fisher LSD (Least Significant Different), Scheffe and Dunn’s (Bonferroni) test. 

```{r }
# compare p-values:
posthoc1 <- as.data.frame(cbind(
  lsd= PostHocTest(r.aov, method="lsd")$group_name[,"pval"],         # The Fisher LSD
  scheffe= PostHocTest(r.aov, method="scheffe")$group_name[,"pval"], # Scheffe
  bonf=PostHocTest(r.aov, method="bonf")$group_name[,"pval"]))       # Bonferroni

posthoc1 <- rownames_to_column(posthoc1, var = "Pair of groups") %>% 
  arrange(desc(scheffe)) 

if( knitr:::is_latex_output() ) {
  knitr::kable(posthoc1, caption = "Posthoc test (lsd, scheffe, bonf)", 
           row.names = FALSE, booktabs = T) %>%
  kable_styling(font_size = 11, full_width = F, latex_options = "hold_position")
} else {
  # split lengthy table into two tables
  tbl1 <- head(posthoc1, 23) 
  tbl2 <- tail(posthoc1, 22)
  knitr::kable(list(tbl1, tbl2), caption = "Posthoc test (lsd, scheffe, bonf)", 
           row.names = FALSE, booktabs = T) %>%
         kable_styling(font_size = 11, full_width = F)
}

```

The Fisher LSD (Least Significant Different) test is the most liberal in all the post hoc test. The Scheffe test is the most conservative in all the post hoc test and protects against Type I error. On the other hand, Dunn’s (Bonferroni) test is extremely conservative [@AndriSignorelletmult.al._2018]. Out of all the possible combination of pairs (45), 16 pair of groups indicates p adj value > 0.9 based on Scheffe test. In statistical terms, it means 16 pairs of groups as shown in the table above have non-significantly different means in number of fatalities.

Next, I use Tukey HSD (Honestly Significant Difference) method which is the most common and preferred method. 

```{r out.width= "100%"}

# extract only p-values by setting conf.level to NA
hsd <- PostHocTest(r.aov, method = "hsd", conf.level=NA)
# convert to data frame and round off to 3 digits
hsd <- as.data.frame(do.call(rbind, hsd)) %>% round(4) # round off to 4 digits

if( knitr:::is_latex_output() ) {
  knitr::kable(hsd, booktabs = T, "latex",
       caption = "Post hoc test with Tukey HSD for Pair of Groups") %>%
       kable_styling(font_size = 7, full_width = F, 
                     position = "left", latex_options = "hold_position")
} else {
  knitr::kable(hsd, booktabs = T,
     caption = "Post hoc test with Tukey HSD for Pair of Groups") %>%
     kable_styling(font_size = 10, full_width = F, position = "left")
}

```

```{r echo=FALSE}
# free up memory
rm(hsd, posthoc1, r.aov, m, ctest, tmp)
```

### Interpretation

The pairs of groups with adj p-value near or equals to 1 represents non-significantly different means in number of fatalities such as Boko Haram - Al-Nusrah, Al-Qaida in Arabian Peninsula (AQAP)- Al-Shabaab, Houthi Extremist- PKK, Taliban- Tehrik-i-Taliban etc. 

Similarly, pair of groups with adjusted p-value near zero indicates signicant different means in number of fatalities such as pairs of ISIL with all the remanining groups, Taliban - Al-Nusrah, PKK - Boko Haram, Donetsk_PR - Al-Nusrah etc. 

